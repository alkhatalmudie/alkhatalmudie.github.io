<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA COMMAND | Secure Uplink</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="assets/css/main.css">
	<link rel="stylesheet" href="assets/css/main.css">
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    
    <style>
        body {
            background-color: #050a15; color: #00f2ff;
            font-family: 'Share Tech Mono', monospace;
            margin: 0; display: flex; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, rgba(0, 242, 255, 0.05) 0%, transparent 60%);
        }

        .login-box {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 242, 255, 0.3);
            padding: 40px; width: 100%; max-width: 400px;
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.1);
            position: relative;
        }

        .login-box::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: #ff4b5c; box-shadow: 0 0 10px #ff4b5c;
        }

        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header i { font-size: 3rem; color: #ff4b5c; margin-bottom: 15px; }
        .login-header h2 { margin: 0; letter-spacing: 2px; }
        .login-header p { font-size: 0.8rem; color: #888; margin-top: 5px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; text-transform: uppercase; }
        .form-group input {
            width: 100%; padding: 12px; box-sizing: border-box;
            background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2);
            color: #00f2ff; font-family: 'Share Tech Mono', monospace; outline: none; transition: 0.3s;
        }
        .form-group input:focus { border-color: #00f2ff; background: rgba(0, 242, 255, 0.1); }

        .btn-exec {
            width: 100%; padding: 15px; background: transparent;
            border: 1px solid #00f2ff; color: #00f2ff; font-family: inherit; font-weight: bold;
            font-size: 1rem; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 2px;
        }
        .btn-exec:hover { background: #00f2ff; color: #050a15; box-shadow: 0 0 20px rgba(0, 242, 255, 0.4); }

        #error-msg { color: #ff4b5c; font-size: 0.85rem; text-align: center; margin-top: 15px; min-height: 20px; }
		
		/* --- SYSTEM TRANSITION EFFECTS --- */
		body {
			opacity: 0; /* Start invisible */
			animation: systemBoot 0.4s ease-in forwards; /* Fade in automatically on load */
		}

		@keyframes systemBoot {
			0% { opacity: 0; transform: scale(0.99); }
			100% { opacity: 1; transform: scale(1); }
		}

		/* Class triggered by JS before leaving the page */
		body.system-shutdown {
			opacity: 0 !important;
			transform: scale(0.99);
		}
		
		/* --- SYSTEM LOADER OVERLAY --- */
		.system-loader {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: #050a15; /* Matches your terminal background */
			z-index: 9999; /* Keeps it on top of everything */
			display: flex;
			justify-content: center;
			align-items: center;
			opacity: 0;
			pointer-events: none; /* Lets clicks pass through when hidden */
			transition: opacity 0.3s ease;
		}

		/* When the JS triggers this class, the screen goes black */
		.system-loader.active {
			opacity: 1;
			pointer-events: all; /* Blocks clicks while loading */
		}

		/* The glowing text */
		.loader-text {
			color: #00f2ff;
			font-size: 1.5rem;
			font-family: 'Share Tech Mono', monospace;
			letter-spacing: 5px;
			text-shadow: 0 0 10px rgba(0, 242, 255, 0.8), 0 0 20px rgba(0, 242, 255, 0.4);
			animation: pulseGlow 1.2s infinite alternate;
		}

		/* The blinking dots */
		.loader-text .dots {
			display: inline-block;
			width: 20px;
			text-align: left;
			animation: blinkDots 1.5s infinite steps(4, end);
		}

		/* Keyframes for the neon pulse */
		@keyframes pulseGlow {
			0% { text-shadow: 0 0 5px rgba(0, 242, 255, 0.5); transform: scale(0.98); }
			100% { text-shadow: 0 0 20px rgba(0, 242, 255, 1), 0 0 40px rgba(0, 242, 255, 0.6); transform: scale(1); }
		}

		/* Keyframes for the typewriter dots */
		@keyframes blinkDots {
			0%, 20% { color: transparent; text-shadow: none; }
			40% { color: #00f2ff; text-shadow: 0 0 10px rgba(0, 242, 255, 0.8); }
			100% { color: #00f2ff; text-shadow: 0 0 10px rgba(0, 242, 255, 0.8); }
		}
		
		::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--term-bg); }
        ::-webkit-scrollbar-thumb { background: var(--term-border); }
    </style>
</head>
<body>

    <div id="system-loader" class="system-loader">
		<div class="loader-text">SYSTEM LOADING<span class="dots">...</span></div>
	</div>
	
    <div class="login-box">
        <div style="text-align: center; padding-bottom: 20px; border-bottom: 1px dashed rgba(255,255,255,0.2);">
            <i class="fas fa-shield-alt" style="font-size: 2.5rem; color: #ff4b5c; margin-bottom: 10px; text-shadow: 0 0 15px rgba(255, 75, 92, 0.4);"></i>
            <h3 style="margin:0; color:white; letter-spacing: 2px;">ALPHA <span style="color:var(--term-cyan);">COMMAND</span></h3>
            <div style="font-size: 0.7rem; color: #888; margin-top: 5px;">SYS.VER 4.0 // ROOT ACCESS</div>
        </div>

        <form id="admin-login-form">
            <div class="form-group">
                <label>Admin Identification</label>
                <input type="email" id="admin-email" required placeholder="Enter commander email...">
            </div>
            <div class="form-group">
                <label>Encryption Passkey</label>
                <input type="password" id="admin-pass" required placeholder="Enter master password...">
            </div>
            <button type="submit" class="btn-exec" id="btn-submit">INITIATE UPLINK</button>
        </form>
        <div id="error-msg"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDT5mqFBwSBea1_5RMXv3_59V4Y5LUy5to",
            authDomain: "al-khat-backend.firebaseapp.com",
            projectId: "al-khat-backend",
            storageBucket: "al-khat-storage-doha",
            messagingSenderId: "310033181926",
            appId: "1:310033181926:web:9a028807fa7c7ab31c5f27"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const ADMIN_UID = "EOQEt04azKTTWcmNXVtpgSVsRxt2";

        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const pass = document.getElementById('admin-pass').value;
            const btn = document.getElementById('btn-submit');
            const errorDiv = document.getElementById('error-msg');

            btn.innerText = "VERIFYING CREDENTIALS...";
            btn.disabled = true;
            errorDiv.innerText = "";

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                if (user.uid === ADMIN_UID) {
                    btn.style.backgroundColor = "#00ff88";
                    btn.style.color = "#050a15";
                    btn.style.borderColor = "#00ff88";
                    btn.innerText = "ACCESS GRANTED. REROUTING...";
                    setTimeout(() => { window.location.href = "alpha.html"; }, 1500);
                } else {
                    // Kick them out immediately if it's a normal user trying to use the Admin Portal
                    await signOut(auth);
                    throw new Error("UNAUTHORIZED IDENTITY. UPLINK SEVERED.");
                }
            } catch (error) {
                errorDiv.innerText = "[ SECURITY BREACH ] " + error.message;
                btn.innerText = "INITIATE UPLINK";
                btn.disabled = false;
            }
        });
		
        /* ============================================================
		   ALPHA COMMAND: UNIVERSAL SYSTEM LOGIC
		   Handles: Page Transitions, Return to Base, and Secure Logout
		   ============================================================ */

		// 1. DISCONNECT UPLINK (Secure Logout)
		window.handleLogout = function() {
			const loader = document.getElementById('system-loader');
			const loaderText = loader ? loader.querySelector('.loader-text') : null;
			
			// Update text based on current language
			if (loaderText) {
				loaderText.innerHTML = (window.currentLang === 'ar') 
					? "جاري قطع الاتصال المشفر<span class='dots'>...</span>" 
					: "DISCONNECTING SECURE UPLINK<span class='dots'>...</span>";
			}

			// Trigger glowing overlay
			if (loader) loader.classList.add('active');

			// Execute Firebase Sign Out
			setTimeout(() => {
				signOut(auth).then(() => { 
					window.location.href = "login_emp.html"; 
				}).catch((err) => {
					if (loader) loader.classList.remove('active');
					console.error("UPLINK FAILURE:", err);
					alert("DISCONNECT ERROR: " + err.message);
				});
			}, 800);
		};

		// 2. RETURN TO BASE (Home Navigation)
		window.handleReturnToBase = function() {
			const loader = document.getElementById('system-loader');
			const loaderText = loader ? loader.querySelector('.loader-text') : null;

			if (loaderText) {
				loaderText.innerHTML = (window.currentLang === 'ar') 
					? "جاري العودة للقاعدة الرئيسية<span class='dots'>...</span>" 
					: "RETURNING TO COMMAND BASE<span class='dots'>...</span>";
			}

			if (loader) loader.classList.add('active');

			// Smooth transition to public site
			setTimeout(() => {
				window.location.href = 'index.html';
			}, 600);
		};
    </script>
	<script>
		document.addEventListener("DOMContentLoaded", () => {
			// --- 1. AUTOMATIC ACTIVE MENU HIGHLIGHTING ---
			let currentPath = window.location.pathname.split('/').pop(); 
			if (currentPath === '') currentPath = 'admin_dashboard.html'; // Or employee_dashboard.html depending on the page

			const menuLinks = document.querySelectorAll('.admin-sidebar-menu a, .dash-sidebar a');
			
			menuLinks.forEach(link => {
				const linkHref = link.getAttribute('href');
				if (linkHref === currentPath) {
					link.classList.add('active');
				}
			});

			// --- 2. SYSTEM LOADER TRANSITIONS ---
			menuLinks.forEach(link => {
				link.addEventListener('click', function(e) {
					const targetUrl = this.getAttribute('href');
					if (!targetUrl || targetUrl === '#' || targetUrl.startsWith('javascript')) return;

					e.preventDefault(); // Stop the hard jump
					
					// Grab the loader and fade it in
					const loader = document.getElementById('system-loader');
					if (loader) {
						loader.classList.add('active');
					}
					
					// Wait 500ms to show the cool animation, then load the next page
					setTimeout(() => {
						window.location.href = targetUrl;
					}, 500); 
				});
			});
		});
	</script>
</body>
</html>