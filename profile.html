<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Personnel File | Al-Khat Al-Mudi</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">

    <style>
        /* TACTICAL BACKGROUND */
        .dashboard-page {
            background-color: #0b1426; 
            background-image: 
                linear-gradient(rgba(11, 20, 38, 0.9), rgba(11, 20, 38, 0.9)),
                url('https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding-top: 100px; /* Clearance for header */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .dashboard-container {
            flex: 1;
            padding: 40px 0;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        /* DARK GLASS PANELS */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* PROFILE SUMMARY */
        .profile-avatar {
            width: 80px; height: 80px;
            background: rgba(0, 242, 255, 0.1);
            border: 2px solid var(--brand-cyan);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; color: var(--brand-cyan);
            margin-bottom: 20px;
        }
        
        .profile-name { font-family: var(--font-primary); font-size: 1.5rem; color: white; margin-bottom: 5px; }
        .profile-email { color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-bottom: 20px; }
        .profile-badge {
            display: inline-block;
            background: rgba(255, 75, 92, 0.2);
            color: #ff4b5c;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 1px solid #ff4b5c;
        }

        /* ORDER HISTORY LIST */
        .order-list { display: flex; flex-direction: column; gap: 15px; }
        .order-item {
            background: rgba(0,0,0,0.3);
            border-left: 4px solid var(--brand-cyan);
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.3s;
        }
        .order-item:hover { background: rgba(0, 242, 255, 0.05); }
        .order-info h4 { margin: 0 0 5px 0; color: white; }
        .order-info p { margin: 0; font-size: 0.85rem; color: rgba(255,255,255,0.6); }
        
        .status-badge {
            padding: 5px 12px; border-radius: 5px; font-size: 0.8rem; font-weight: bold;
        }
        .status-pending { background: rgba(255, 193, 7, 0.2); color: #ffc107; border: 1px solid #ffc107; }
        .status-completed { background: rgba(40, 167, 69, 0.2); color: #28a745; border: 1px solid #28a745; }

        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="dashboard-page">

    <header>
            <div class="container">
                <nav class="navbar">
                    <a href="index.html" class="logo-box" style="text-decoration: none;">
                        <div class="dna-logo">
                            <div class="dna-drop dna-magenta"></div>
                            <div class="dna-drop dna-cyan"></div>
                        </div>
                        <div class="brand-text">
                            <h3>Al-Khat Al-Mudi</h3>
                            <span id="header-brand_sub">TRANSLATION SERVICES</span>
                        </div>
                    </a>
                    
                    <div id="user-profile-section" class="user-status-hidden">
                        <a href="profile.html" class="user-orb">
                            <i class="fas fa-user-circle"></i>
                            <span id="user-display-name">Client</span>
                        </a>
                        <button onclick="handleLogout()" class="logout-link">Logout</button>
                    </div>
                    
                    <a href="#menu" class="menu-toggle" id="menuToggle">
                        <span class="text" id="header-menu_btn">MENU</span>
                        <div class="hamburger">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </a>
                    
                </nav>
            </div>
    </header>

    <main class="dashboard-container container">
        <div style="margin-bottom: 30px;">
            <h2 style="color: var(--brand-cyan);"><i class="fas fa-terminal"></i> SECURE TERMINAL</h2>
            <p style="color: rgba(255,255,255,0.7);">Encrypted Personnel Dashboard</p>
        </div>

        <div class="dashboard-grid">
            
            <div class="glass-panel" style="align-self: start;">
                <div class="profile-avatar">
                    <i class="fas fa-user-astronaut"></i>
                </div>
                <h3 class="profile-name" id="dash-name">Loading Agent Data...</h3>
                <p class="profile-email" id="dash-email">awaiting link...</p>
                <div class="profile-badge" id="dash-rank">CLEARANCE: CLIENT</div>
                
                <button id="btn-admin-deploy" class="btn btn-primary" style="display: none; width: 100%; margin-top: 20px; background: var(--brand-magenta); border-color: var(--brand-magenta);">
				<i class="fas fa-rocket"></i> Alpha Backend Dashboard
				</button>
                
                <hr style="border-color: rgba(255,255,255,0.1); margin: 25px 0;">
                
                <ul style="list-style: none; padding: 0; margin: 0; color: rgba(255,255,255,0.8); line-height: 2;">
                    <li><i class="fas fa-shield-alt" style="color: var(--brand-cyan); width: 20px;"></i> Connection: TLS 1.3</li>
                    <li><i class="fas fa-server" style="color: var(--brand-cyan); width: 20px;"></i> Node: ME-CENTRAL1 (Doha)</li>
                </ul>
            </div>

            <div class="glass-panel">
                <h3 style="margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
                    <i class="fas fa-folder-open" style="color: var(--brand-cyan);"></i> Transmission History
                </h3>
                
                <div class="order-list" id="order-history-container">
                    <div style="text-align: center; padding: 20px; opacity: 0.5;">
                        <i class="fas fa-circle-notch fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Scanning database logs...</p>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer id="contact">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <div class="dna-logo" style="margin-bottom: 20px;">
                        <div class="dna-drop dna-magenta"></div>
                        <div class="dna-drop dna-cyan"></div>
                    </div>
                    <h3 class="arabic-text">الخط المضيء للترجمة</h3>
                    <p id="footer-about_text" style="opacity: 0.7; line-height: 1.6; margin-bottom: 25px;">
                        Your partner in overcoming language barriers. We provide quality, speed, and reliability for all your translation needs.
                    </p>
                     <div class="social-icons">
                        <a href="https://www.facebook.com/share/1Gtg7R2phb/" class="social-icon facebook" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://instagram.com/alkhatalmudi" class="social-icon instagram" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://wa.me/message/BFW6NB4D4ZLLL1" class="social-icon whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" class="social-icon linkedin" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>

                <div class="footer-col">
                    <h4 id="footer-col_links">Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="#" id="menu-home-footer">Home</a></li>
                        <li><a href="#about" id="menu-about-footer">About Us</a></li>
                        <li><a href="#services" id="menu-services-footer">Services</a></li>
                        <li><a href="#reservation" id="menu-quote-footer">Get a Quote</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4 id="footer-col_legal">Legal</h4>
                    <ul class="footer-links">
                        <li><a href="#" id="footer-privacy">Privacy Policy</a></li>
                        <li><a href="#" id="footer-terms">Terms of Service</a></li>
                        <li><a href="#">Confidentiality</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4 id="footer-col_contact">Contact Us</h4>
                    <ul class="contact-info">
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Marka Al-Shamaliya, Nadi Al-Sibaq<br>Amran Mall, 3rd Floor, Office 15</span>
                        </li>
                        <li>
                            <i class="fas fa-phone-alt"></i>
                            <span>078-077-0085</span>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>alkhatalmudi@gmail.com</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p id="footer-copyright">&copy; 2026 Al-Khat Al-Mudi Translation. All rights reserved.</p>
        </div>
    </footer>

    <div id="side-menu" class="menu-panel">
        <a href="javascript:void(0)" class="close-btn" id="closeMenu">&times;</a>

        <div class="menu-content">
            <h4 class="menu-label" id="menu-label_nav">NAVIGATION</h4>
            <ul class="main-links">
                <li><a href="index.html" id="menu-home">Home</a></li>
                <li class="dropdown-trigger">
                    <a href="javascript:void(0)"><span id="menu-pages">Pages</span> <i class="fas fa-chevron-down"></i></a>
                    <ul class="dropdown-list">
                        <li><a href="about.html" id="menu-about">About Us</a></li>
                        <li><a href="services.html" id="menu-services">Services</a></li>
                        <li><a href="translation.html" id="menu-translation">Translation Info</a></li>
                        <li><a href="packages.html" id="menu-packages">Packages & Pricing</a></li>
                        <li><a href="shop.html" id="menu-shop">Shop / Products</a></li>
                        <li><a href="reservation.html" id="menu-reservation">Book Reservation</a></li>
                        <li><a href="contacts.html" id="menu-contact">Contact Us</a></li>
                    </ul>
                </li>
            </ul>

            <h4 class="menu-label" id="menu-label_member">MEMBER AREA</h4>
            <div class="auth-buttons">
                <a href="login.html" class="btn-auth login" id="menu-login">Log In</a>
                <a href="signup.html" class="btn-auth signup" id="menu-signup">Sign Up</a>
            </div>

            <h4 class="menu-label" id="menu-label_region">REGION SELECT</h4>
            <div class="lang-grid">
                <a href="javascript:void(0)" onclick="switchLanguage('en')" class="lang-orb" title="English"><img src="images/GB.png" alt="English"></a>
                <a href="javascript:void(0)" onclick="switchLanguage('ar')" class="lang-orb" title="Arabic"><img src="images/Ar.png" alt="Arabic"></a>
                <a href="javascript:void(0)" onclick="switchLanguage('du')" class="lang-orb" title="Dutch"><img src="images/Du.png" alt="Dutch"></a>
                <a href="javascript:void(0)" onclick="switchLanguage('ru')" class="lang-orb" title="Russian"><img src="images/Ru.png" alt="Russian"></a>
            </div>
        </div>
    </div>
    
    <script src="assets/js/main.js"></script>
    <script src="assets/js/lang-engine.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDT5mqFBwSBea1_5RMXv3_59V4Y5LUy5to",
            authDomain: "al-khat-backend.firebaseapp.com",
            projectId: "al-khat-backend",
            storageBucket: "al-khat-storage-doha",
            messagingSenderId: "310033181926",
            appId: "1:310033181926:web:9a028807fa7c7ab31c5f27"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Security Check: Ensure user is logged in
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Populate Profile Panel
                document.getElementById('dash-name').innerText = user.displayName || "Unknown Agent";
                document.getElementById('dash-email').innerText = user.email;
                
                // Admin Override Visuals & Logic
                if(user.uid === "EOQEt04azKTTWcmNXVtpgSVsRxt2") {
                    document.getElementById('dash-rank').innerText = "CLEARANCE: ALPHA COMMANDER";
                    document.getElementById('dash-rank').style.background = "rgba(0, 242, 255, 0.2)";
                    document.getElementById('dash-rank').style.color = "var(--brand-cyan)";
                    document.getElementById('dash-rank').style.borderColor = "var(--brand-cyan)";
                    
                    // UNLOCK THE DEPLOYMENT BUTTON AND ROUTE TO ALPHA
                    const deployBtn = document.getElementById('btn-admin-deploy');
                    if(deployBtn) {
                        deployBtn.style.display = 'block';
                        deployBtn.onclick = () => { window.location.href = "alpha.html"; };
                    }
                }

                // Fetch User's Orders
                fetchOrderHistory(user.uid);
            } else {
                // Not logged in? Kick them to the login page
                window.location.href = "login.html";
            }
        });

        async function fetchOrderHistory(uid) {
            const container = document.getElementById('order-history-container');
            
            try {
                const q = query(collection(db, "orders"), where("userId", "==", uid));
                const querySnapshot = await getDocs(q);
                
                container.innerHTML = ""; // Clear loader
                
                if (querySnapshot.empty) {
                    container.innerHTML = `<p style="text-align: center; color: rgba(255,255,255,0.6); padding: 20px;">No translation requests found in the archives.</p>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const date = data.timestamp ? data.timestamp.toDate().toLocaleDateString() : "Unknown Date";
                    
                    // --- UPGRADED LOGIC AREA ---
                    const statusClass = data.status === "Completed" ? "status-completed" : "status-pending";
                    const statusText = data.status || "Pending Review";

                    // Build the status and button area
                    let actionArea = `<span class="status-badge ${statusClass}">${statusText}</span>`;
                    
                    // If mission is completed and the file exists, append the download button
                    if(data.status === "Completed" && data.translatedFileUrl) {
                        actionArea += `<br><a href="${data.translatedFileUrl}" target="_blank" class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem; margin-top: 10px; display: inline-block;">
                            <i class="fas fa-file-download"></i> Download Translation
                        </a>`;
                    }

                    const itemHtml = `
                        <div class="order-item">
                            <div class="order-info">
                                <h4>Order ID: ${doc.id.substring(0, 8).toUpperCase()}</h4>
                                <p><i class="fas fa-calendar-alt"></i> ${date} | Contact: ${data.customerName || 'N/A'}</p>
                            </div>
                            <div class="order-status" style="text-align: right;">
                                ${actionArea}
                            </div>
                        </div>
                    `;
                    // --- END UPGRADED LOGIC ---

                    container.innerHTML += itemHtml;
                });
            } catch (error) {
                console.error("Error fetching orders: ", error);
                container.innerHTML = `<p style="color: #ff4b5c;">Error communicating with Firebase Cloud. Please refresh.</p>`;
            }
        }

        // Global Logout Function
        window.handleLogout = function() {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        }
    </script>
</body>
</html>